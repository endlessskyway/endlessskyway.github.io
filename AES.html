<!DOCTYPE html>
<meta charset="utf-8"/>
<html>
<!--Begin "embedded .css file"    -->
<!--The .css file is "embedded" to simplify promulgation.  It's all just one file (this file).   -->
<style>
body {  background-color: #E9B96E;   }<!--#66cc66 #66b5ff #7967ff #796788 #E9B96E -->
.buttonText {
  font-family: Courier New;
  font-size: 18px;
  color: black;
  display:inline;
}
.startButtonText {
  font-family: Courier New;
  font-size: 16px;
  color: black;
  display:inline;
  background-color: LightGreen;
}
input[type=number]{
    width: 30px;
}
</style>
<!--End "embedded .css file"-->
<head>
<title>Un-Live AES Pad</title>
</head>
<body>

<!-- Remove links starting here -->
<DIV STYLE="font-family: Arial; font-size: 16px; color: blue">
<a href="../index.html">&lt;&lt;Home&nbsp;Page</a>
&nbsp;
<a href="../contact.html">Contact</a>
&nbsp;
<a href="../u-fly-it-satellite-and-space-elevator.html">Space&nbsp;Elevator&nbsp;Simulator</a>
&nbsp;
<a target = "_blank" href="https://www.youtube.com/watch?v=0qy6poZOVA4&list=PLcUC5KvBSoCqg4SYxPJKwUyD6v2er96iE">Tutorial&nbsp;video&nbsp;for&nbsp;this</a>
&nbsp;
<a href="../engines_of_our_ingenuity_sequential_player.html">Engines&nbsp;&nbsp;of&nbsp;Our&nbsp;Ingenuity&nbsp;Player</a>
&nbsp;
<a href="../unlive_newtab.html">Unlive&nbsp;Newtab</a>
</div>
<!-- Remove links ending here -->

<br>
<span title= "'Un-live' means the page isn't 'live' with insecure, annoying, and
     indescernible logic that serves no purpose for the user. I.e. ...

-- 100% Local only. (all computation is done locally on this page).
-- No Cookies.
-- No LSOs.
-- Single html page only.
-- No fake whitespace which can track mouse movements, frustrate navigation, etc..
-- No tracking.
-- No tracking links.
-- No downloads except for the initial page load of a single file from one location.
-- No phoning home.
-- No phoning *anywhere* fer cryin out loud.
-- Storeable as and runnable from a local file so it need not access its
     source on the internet at all. 
-- Etc.

" STYLE="font-family: Courier New; font-size: 32px; color: black">
<b><u>Un-Live AES Pad</u></b></span><span STYLE="font-family: Courier New; font-size: 24px; color: black">&nbsp;&nbsp;&nbsp;by Endlessskyway,&nbsp;&nbsp;May 2014</span>

<DIV STYLE="font-family: Courier New; font-size: 8px;"><br></DIV>
<DIV STYLE="font-family: Courier New; font-size: 20px; color: black">
<span title="All calculation is done locally w/ CryptoJS libraries pre-pasted into this one-file page.
No internet access is made after the initial downloading of this page except for the
links at the top and bottom - and then only if you click them.  Even so, the links are
*easily* removable when (when!) you copy this page's source to a local file, verify it,
and then only run this page from that local file.">100% Local</span>
-&nbsp;No cookies
-&nbsp;No LSOs
-&nbsp;One html page only
-&nbsp;<span title="All that looks like whitespace is actually whitespace -- and there's plenty of it.  No tracking mouse movements, etc. without user's knowkedge.">No fake whitespace</span>
<br>
No tracking - 
<span title="The links at the top and bottom of the page don't do any tracking.
The links' targets *might* track referrers (Youtube targets surely will when they can).
The links are easily removable by editing them out of the source for this page,
saving the new source as an .html file, then opening that local file in your browser.">
No tracking links</span>
 - No downloads - No phoning home or <i>anywhere</i>
<DIV STYLE="font-family: Courier New; font-size: 8px;"><br></DIV>
<span title="Before using this for anything seriously important, you'll want to verify this code:
1) Save the source to a local file.**
2) Verify the file manually:
    2a) Compare the CryptoJS libraries used here with their valid sources.
    2b) Review the remaining html5 code for anything untoward or insecure.
            -- it's a smallish file so it's not too big a job.
3) Then run this only from the local file that you verified.***
4) When this page is updated with improvements and fixes, you'll want to repeat 1) and 2) before you use the new version for anything serious.

**To save the source,
You can download the html file using the link (it's the same as this page's source).
Or, you can also go to 'View source' in the browser, then copy the text and paste it into a local html file. 

***Running from a local file protects against using refreshed versions of the page that
you haven't yet reviewed or verified.  Refreshed versions of the page have the risk of
new bugs and the potential for having been modified enroute to you by a third (evil) party.">
Verify by reviewing source: <a href="AES.html" download >Download source for this page</a>
</span>
<DIV STYLE="font-family: Courier New; font-size: 8px;"></DIV>

</DIV>

<DIV STYLE="font-family: Courier New; font-size: 18px; color: #040">
<!--pbkdf2_iterations:<textarea readonly id="pbkdf2_iterations_box"  STYLE="font-family: Courier New; font-size: 12px; color: black" rows="1" cols="5"></textarea><br>-->
<br>
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>  -->

<!--<input type="button" onclick="just_select('pw_box')" value="Select" STYLE="height:26px"/>  -->
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_copy_to_clipboard('pw_box')" value="Copy box" />
<!--<input type="button" onclick="paste('pw_box')" value="paste" STYLE="height:26px"/> -->
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_delete_selected_text('pw_box')" value="Del" />
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_delete_unselected_text('pw_box')" value="Trim" />
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_clear_register('pw_box')" value="Clear box" />
<b><big>Password&nbsp;</b></big>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PW tools:
<input type="button" onclick="d_shuffle()" value="Shuffle" title="Mix up the positions of the characters currently in the box below.
-- Uses Math.random() for random number source."/>
<input type="button" onclick="get_base64_characters(8)" value="+base64" title="Add 8 random base64 characters (6 bits of entropy each).
-- Slash (/) is replaced with tilde (~).
-- Uses CryptoJS.lib.WordArray.random() for the random number source."/>
<input type="button" onclick="get_hex_characters(8)" value="+hex" title="Add 8 random hex characters (4 bits of entropy each).
-- Uses CryptoJS.lib.WordArray.random() for the random number source."/>
<!--<input type="button" onclick="d_clear_register('pw_box')" value="Clear register" /> -->
<br>

<textarea id="pw_box"  STYLE="font-family: Courier New; font-size: 16px; color: #050; background-color: #efe" placeholder="Put password here, and make it a good one!" rows="1" cols="84" wrap="on"
title = "Enter your password here.
You want at least 128 bits of entropy in your password for non-trivial encryption.
If your random number generator is up to snuff, each random base64 character will have 6 bits of entropy, each random hex character will have 4.
To help compensate for less-than-fully-par random number generation, try adding your own characters in addition to the generated characters, hit the shuffle button a bunch of times, and delete some characters -- repeat and mix up those actions.  Random.org might also be of some assistance.
If there are a conservative 4 bits of entropy per character, 32 characters will give you that 128 bits you need, 64 characters will give you 256 bits if you want that.">
</textarea><br>
<DIV STYLE="font-family: Courier New; font-size: 16px;"><br></DIV>

<!--<input type="button" onclick="just_select('pw_box')" value="Select" STYLE="height:26px"/>  -->
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_copy_to_clipboard('plaintext_box')" value="Copy box" />
<!--<input type="button" onclick="paste('pw_box')" value="paste" STYLE="height:26px"/> -->
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_delete_selected_text('plaintext_box')" value="Del" />
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_delete_unselected_text('plaintext_box')" value="Trim" />
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_clear_register('plaintext_box')" value="Clear box" />
<b><big>Plaintext</b></big>
<!--<input type="button" onclick="d_copy_to_clipboard('plaintext_box')" value="Copy to clipboard" /> -->
<!--<input type="button" onclick="d_clear_register('plaintext_box')" value="Clear register" /> -->
<!--<b><big>&nbsp;&nbsp;Encrypt/hash</b></big> -->
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" onclick="d_encrypt('plaintext_box')" value="Encrypt this" style="background-color:#acc; color:#000; height:35px" width="48" height="48" />
<input type="button" onclick="d_sha256('plaintext_box')" value="SHA256" style="background-color:#aaa; color:#000; height:30px" width="48" height="48" title="Put SHA-256 hash into the result box instead of the encrypted text."/>
<input type="button" onclick="d_sha512('plaintext_box')" value="SHA512" style="background-color:#aaa; color:#000; height:30px" width="48" height="48" title="Put SHA-512 hash into the result box instead of the encrypted text."/>
<br>
<textarea id="plaintext_box" wrap="on" STYLE="font-family: Courier New; font-size: 16px; color: green; background-color: #efe" rows="5" cols="84"  placeholder="Put data (text) to be encrypted here."></textarea><br>
</div>

<DIV STYLE="font-family: Courier New; font-size: 16px; color: purple">
Incidentals: 

<span STYLE="font-family: Courier New; font-size: 16px;">
<a onclick="get_new_pbkdf2_iterations()" 
title="
If you checked the 'Prevent additional dialogs' box, this function will not work
until you refresh the page.  But really, just don't check that booby-trap box.

If you don't know what this number is, leave it at the default (currently 1024).
Increasing this number increases the time it takes to compute the key
from the password and the salt, which decreases the required size of the
password by a small amount.  Anything over about 2000 iterations might be
agonizingly slow for realtime back and forth.  Experiment!
This number (of iterations) now gets embedded into the encrypted output text
so the decryption procedure will know what number of iterations to use.  That way,
changing the number on the encryption end will not affect the ability to decrypt.
You can see the 8-character string holding the number starting after the
initialization vector in the encrypted output text.
The number of iterations describes (in part) the nature of the algorithm, but not
specifics nor clues to the key, password, or plaintext.  So, it's okay to put it
in the encrypted text for our purposes.  For some purposes, we would want to hide
even the fact that the visible data is an encryption of something, but that's not
our purpose here (yet).
 " /><u>[Click here to change the number of pbkdf2 iterations]</u></a> </span>
<br>
<textarea readonly STYLE="font-family: Courier New; font-size: 12px; color: black; background-color: #eee" id="saltiv_box" wrap="off" rows=1 cols="75"></textarea>
<input type="button" onclick="d_make_new_salt()" value="New Salt" style="background-color:#acc; color:#000; height:35px" width="48" height="48" />
<input type="button" onclick="d_make_new_iv()" value="New IV"    style="background-color:#acc; color:#000; height:35px" width="48" height="48" />
<br>
<textarea readonly STYLE="font-family: Courier New; font-size: 12px; color: black; background-color: #eee" id="incidentals_box" wrap="off" rows=4 cols="75"></textarea>

<input id="autosalt_toggle_button" type="button" onclick="set_autosalt('toggle')"
title="This parameter tells whether to automatically generate
new salt with every push of the 'Encrypt' button.
For operations, it should always be ON.
For experimenting to see how things work, it may be set to OFF.
If you can't set this to OFF, it might have been defaulted unchangably
to 'ON' directly in the html5 code (to reduce risk of accidentally having
it OFF for operations)."
value="INitIal_string (error)" STYLE="font-family: Courier New; font-size: 12px; color: #000; background-color: #ccc;  width:130px; height:24px"/>

<input id="autoiv_toggle_button" type="button" onclick="set_autoiv('toggle')"
title="This parameter tells whether to automatically generate a new initialization
vector ('iv') with every push of the 'Encrypt' button.
For operations, it should always be ON.
For experimenting to see how things work, it may be set to OFF.
If you can't set this to OFF, it might have been defaulted unchangably
to 'ON' directly in the html5 code (to reduce risk of accidentally having
it OFF for operations)."
value="INitIal_string (error)" STYLE="font-family: Courier New; font-size: 12px; color: #000; background-color: #ccc;  width:125px; height:24px"/>


<br>
</div>

<DIV STYLE="font-family: Courier New; font-size: 18px; color: #040"></div>


<DIV STYLE="font-family: Courier New; font-size: 18px; color: blue">
<br>
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>  -->

<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_copy_to_clipboard('encrypted_base64_box')" value="Copy box" />
<!--<input type="button" onclick="paste('pw_box')" value="paste" STYLE="height:26px"/> -->
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_delete_selected_text('encrypted_base64_box')" value="Del" />
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_delete_unselected_text('encrypted_base64_box')" value="Trim" />
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_clear_register('encrypted_base64_box')" value="Clear box" />
<!--<input type="button" onclick="d_copy_to_clipboard('encrypted_base64_box')" value="Copy to clipboard" /> -->
<!--<input type="button" onclick="d_clear_register('encrypted_base64_box')" value="Clear register" /> -->
<b><big>Encrypted (or hash) result</b></big>
&nbsp;&nbsp;
<input type="button" onclick="d_copy_encrypt_result_to_encrypt_input()" value="R2I" title="Copy this box (the Result) to the decryption box (the Input)."/>
<input type="button" onclick="d_box_cycle_format('encrypted_base64_box')" value="Cycle format" title="64 characters per line (with header/footer)
-then-
32 characters per line  (with header/footer)
-then-
No line breaks and no header/footer
-then-
etc."/>
<br>
<!--<small><small>(64 hex characters containing salt+iv, then base64)</small></small><br>-->
<textarea readonly STYLE="font-family: Courier New; font-size: 16px; color: blue; background-color: #eef" placeholder="No result (yet).  Press the 'Encrypt' button or a hash button above." id="encrypted_base64_box" wrap="on" rows="5" cols="84"></textarea><br>

</div>


<DIV STYLE="font-family: Courier New; font-size: 18px; color: brown">
<br>
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>  -->

<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_copy_to_clipboard('encrypted_input_box')" value="Copy box" />
<!--<input type="button" onclick="paste('pw_box')" value="paste" STYLE="height:26px"/> -->
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_delete_selected_text('encrypted_input_box')" value="Del" />
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_delete_unselected_text('encrypted_input_box')" value="Trim" />
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_clear_register('encrypted_input_box')" value="Clear box" />
<b><big>Encrypted text for decryption</b></big>&nbsp;&nbsp;
<!--<input type="button" onclick="d_copy_to_clipboard('encrypted_input_box')" value="Copy to clipboard" />&nbsp; -->
<!--<input type="button" onclick="d_clear_register('encrypted_input_box')" value="Clear register" />&nbsp; -->
&nbsp;&nbsp;&nbsp;
<input type="button" onclick="d_decrypt()" value="Decrypt this" style="background-color:#acc; color:#000; height:35px"/>
<br>
<!--<small><small>(64 hex characters containing salt+iv, then base64)</small></small><br>-->
<textarea STYLE="font-family: Courier New; font-size: 16px; color: brown; background-color: #fee" placeholder="Paste encrypted text here for decryption." id="encrypted_input_box" wrap="on" rows="5" cols="84"></textarea><br>
<br>

<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_copy_to_clipboard('decrypted_text_box')" value="Copy box" />
<!--<input type="button" onclick="paste('pw_box')" value="paste" STYLE="height:26px"/> -->
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_delete_selected_text('decrypted_text_box')" value="Del" />
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_delete_unselected_text('decrypted_text_box')" value="Trim" />
<input type="button" style="background-color:#088; color:#fff; height:26px" onclick="d_clear_register('decrypted_text_box')" value="Clear box" />
<b><big>Decrypted text result</b></big>&nbsp;
<br>
<!--<input type="button" onclick="d_copy_to_clipboard('decrypted_text_box')" value="Copy to clipboard" />&nbsp; -->
<!--<input type="button" onclick="d_clear_register('decrypted_text_box')" value="Clear register" />&nbsp; -->
<textarea readonly STYLE="font-family: Courier New; font-size: 16px; background-color: #fee" id="decrypted_text_box" wrap="off" rows="5" cols="84" placeholder="Empty."></textarea><br>

</div>

<DIV STYLE="font-family: Courier New; font-size: 16px; color: black">
<PRE>
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>  -->
<b><big>ABOUT and HELP</b></big>

1) <b>Independent</b> client.
Most of today's vaunted "end to end" encryption uses end-clients that are built
*and updated* by the same entity that provides the channel services.  That opens
up the opportunity for back doors, new unintended breakage of encryption, new
*intended* breakage of encryption, etc..  An example is what Microsoft did to Skype.
Before MS, Skype was (presumably) encrypted end-to-end where intermediaries on the
channel could not see the data.  Now, by way of updates to <b>their</b> client, MS sees
and *stores* all of your IM messages.  An independent client (a crude one as this is) is
necessary to thwart those kinds of intentional update threats as well as other
unintentional ones.  <b>Multiple</b> mutually independent clients operating in series are
even more ideal to mitigate errors or leaks in any single encryption client.

2) <b>Visible</b> client.
An encryption end-client should be visible and verifible as to how it does its
encryption, how it does or does not access other local or remote/internet process, etc.
Encryption end-clients written in an interpreted language (Python, Javascript, etc.),
and well laid out, are very much more visible in that regard.  The KISS principle, as
well as limiting scope creep in a design, help to increase visibility inside end-client
codes.  This client's code probably could be laid out better, and I </b>have</b>
scope-creeped a bit as differing things spurred my interest, but it <b>is</b> in
Javascript and so it's somewhat more visible and verifiable for that.

3) Local only.
This page is a single html5 file that runs fully locally.  No accessing the internet.
No cookies.  No other "local storage".  No spying on you "justified" by some
company's asinine rationalization of <b>their own</b> greater good.  Only the links
on the top and bottom of the page try to go to the internet, but you can easily strip
them out when you make your own local .html file from this, which you <b>should</b> do.

4) Best way to run it.
Grab the source of this "page", save it into a local .html file, and it should run
just the same.  That's actually the preferred way of running this -- to guard
against "meddling" on your page load.  In fact, it's even better to run that local
.html file in some alternate browser that's cut off from the internet by whatever
means you like.

5) Javascript *is* required.
As paranoid as you should be with regard to letting Javascript run in your
browser, it should also be obvious that Javascript does need to be turned on in the
browser (or tab) for this to work.  The Javascript here does nothing untoward, as
you can verify by looking at it in the page source, which I recommend you do.

6) All-in-one-file.
The CryptoJS v3.1.2 files are pasted in this html page explicitly.  Explicit pasting
is done so there is no accessing anything on the internet with the associated risks.
Anyone can verify that the pasted source codes here match the v3.1.2 files from
the proper sources on the internet.  I recommend you do that.  If they don't match,
don't use this code, because that means either this or the other is corrupted and it
might be this.

7) Format of the encrypted results.
The encrypted results here have the first N characters as hex (containing the salt
and the initialization vector), with the rest as base64.  That's less than fully
desirable.  Any encrypted stream generally should be indistinguishable from random
noise.  The switch from hex to base64 "says something" about what's going on, but
since we're not trying to hide what that something is, it's okay to leave it like
that for now.

8) Size of the encrypted results.
Sending out the encrypted stream in (mostly) base64 means only 6 bits per renderable
character.  So, the base64 part of the encrypted message is going to be 6/8ths as
dense as the original plaintext.  That is, 8/6ths the size or 33% bigger (plus a
little for padding).  The advantage is that the base64-encoded encrypted stream is
cut/pastable, renderable, and handlable as ordinary text.  If the data stream didn't
need to be handlable as text, that part of the stream would be the same length as
the plaintext plus what ever small amount of padding proved necessary.  Similarly,
the N hex characters at the beginning are only 4 bits each meaning that if they
didn't need to be handlable as text, then that part of the stream would only be N/2
bytes long.

9) Dealing with the base64 "/".
The "/" used by the base64 libraries has the disadvantage of sometimes being
rendered along with a carriagereturn and linefeed, which can add difficulty to
displaying and handling the resulting encoded text.  I've included some functions
and buttons to replace the slash with a substitute character (probably "~") so the
encrypted text can be pasted into other programs with less difficulty.  I adjusted
the decrypt function to treat both the slash and the substitute character as a slash.
That way, decrypting encrypted text that uses the substitute character will work
seemlessly.  I might eventually get rid of the slash completely since any encrypted
text made by this program is only ever intended to be decrypted using this program.
---Actually, I *did* get rid of the slash.  The alternate character is now used by
default, and the slash will never show up.  If the slash does get in the box for
input for decryption, it is interpreted the same as the substitute character and
will work just the same.

10) Formats.
Before the string in the encryption box is decrypted, any slash-substitutes are
first converted to actual slashes (which the decryption function expects),
then all non-base64 characters in the string are purged from it.  This enables
breaking the "long string" up into rows and adding prefix and postfix characters
at the beginning and end to help in displaying and handling the encrypted text.
The "Cycle formats" button cycles through the N formats of the encrypted output text.
Currently, the three (or "N") formats are:
    1) 64 characters per line (with prefix and postfix),
    2) 32 characters per line (with prefix and postfix), and
    3) No line breaks and no prefix or postfix.
Any format of the same base64 string will decrypt the same as the other formats.
<br>
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>  -->
</PRE>
</div>

<!-- Remove links starting here -->
<DIV STYLE="font-family: Arial; font-size: 16px; color: blue">
<a href="../index.html">&lt;&lt;Home&nbsp;Page</a>
&nbsp;
<a href="../contact.html">Contact</a>
&nbsp;
<a href="../u-fly-it-satellite-and-space-elevator.html">Space&nbsp;Elevator&nbsp;Simulator</a>
&nbsp;
<a target = "_blank" href="https://www.youtube.com/watch?v=0qy6poZOVA4&list=PLcUC5KvBSoCqg4SYxPJKwUyD6v2er96iE">Tutorial&nbsp;video&nbsp;for&nbsp;this</a>
&nbsp;
<a href="../engines_of_our_ingenuity_sequential_player.html">Engines&nbsp;&nbsp;of&nbsp;Our&nbsp;Ingenuity&nbsp;Player</a>
&nbsp;
<a href="../unlive_newtab.html">Unlive&nbsp;Newtab</a>
</div>
<!-- Remove links ending here -->
<br>
<br>
<br>
<br>
<br>
<!--******************************************************************************************-->
<!--******************************************************************************************-->

<!--
--These are the CryptoJS v3.1.2 files pasted in here explicitly.
--Explicit pasting is done so there is no accessing the files
    on the internet with the associated risks.
--Anyone can verify that the pasted source codes here match the
    v3.1.2 files from the proper sources on the internet.
--I recommend YOU DO THAT.
--If they don't match, DON'T USE THIS CODE, because one or the other is corrupted. 
-->
<!-- src="CryptoJS v3.1.2/rollups/sha256.js" -->
<script type="text/javascript"">
/* CryptoJS v3.1.2 code.google.com/p/crypto-js (c) 2009-2013 by Jeff Mott. All rights reserved. code.google.com/p/crypto-js/wiki/License */
var CryptoJS=CryptoJS||function(h,s){var f={},t=f.lib={},g=function(){},j=t.Base={extend:function(a){g.prototype=this;var c=new g;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
q=t.WordArray=j.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=s?c:4*a.length},toString:function(a){return(a||u).stringify(this)},concat:function(a){var c=this.words,d=a.words,b=this.sigBytes;a=a.sigBytes;this.clamp();if(b%4)for(var e=0;e<a;e++)c[b+e>>>2]|=(d[e>>>2]>>>24-8*(e%4)&255)<<24-8*((b+e)%4);else if(65535<d.length)for(e=0;e<a;e+=4)c[b+e>>>2]=d[e>>>2];else c.push.apply(c,d);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
32-8*(c%4);a.length=h.ceil(c/4)},clone:function(){var a=j.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],d=0;d<a;d+=4)c.push(4294967296*h.random()|0);return new q.init(c,a)}}),v=f.enc={},u=v.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;b<a;b++){var e=c[b>>>2]>>>24-8*(b%4)&255;d.push((e>>>4).toString(16));d.push((e&15).toString(16))}return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;b<c;b+=2)d[b>>>3]|=parseInt(a.substr(b,
2),16)<<24-4*(b%8);return new q.init(d,c/2)}},k=v.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;b<a;b++)d.push(String.fromCharCode(c[b>>>2]>>>24-8*(b%4)&255));return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;b<c;b++)d[b>>>2]|=(a.charCodeAt(b)&255)<<24-8*(b%4);return new q.init(d,c)}},l=v.Utf8={stringify:function(a){try{return decodeURIComponent(escape(k.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return k.parse(unescape(encodeURIComponent(a)))}},
x=t.BufferedBlockAlgorithm=j.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=l.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,d=c.words,b=c.sigBytes,e=this.blockSize,f=b/(4*e),f=a?h.ceil(f):h.max((f|0)-this._minBufferSize,0);a=f*e;b=h.min(4*a,b);if(a){for(var m=0;m<a;m+=e)this._doProcessBlock(d,m);m=d.splice(0,a);c.sigBytes-=b}return new q.init(m,b)},clone:function(){var a=j.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});t.Hasher=x.extend({cfg:j.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){x.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,d){return(new a.init(d)).finalize(c)}},_createHmacHelper:function(a){return function(c,d){return(new w.HMAC.init(a,
d)).finalize(c)}}});var w=f.algo={};return f}(Math);
(function(h){for(var s=CryptoJS,f=s.lib,t=f.WordArray,g=f.Hasher,f=s.algo,j=[],q=[],v=function(a){return 4294967296*(a-(a|0))|0},u=2,k=0;64>k;){var l;a:{l=u;for(var x=h.sqrt(l),w=2;w<=x;w++)if(!(l%w)){l=!1;break a}l=!0}l&&(8>k&&(j[k]=v(h.pow(u,0.5))),q[k]=v(h.pow(u,1/3)),k++);u++}var a=[],f=f.SHA256=g.extend({_doReset:function(){this._hash=new t.init(j.slice(0))},_doProcessBlock:function(c,d){for(var b=this._hash.words,e=b[0],f=b[1],m=b[2],h=b[3],p=b[4],j=b[5],k=b[6],l=b[7],n=0;64>n;n++){if(16>n)a[n]=
c[d+n]|0;else{var r=a[n-15],g=a[n-2];a[n]=((r<<25|r>>>7)^(r<<14|r>>>18)^r>>>3)+a[n-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+a[n-16]}r=l+((p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25))+(p&j^~p&k)+q[n]+a[n];g=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&f^e&m^f&m);l=k;k=j;j=p;p=h+r|0;h=m;m=f;f=e;e=r+g|0}b[0]=b[0]+e|0;b[1]=b[1]+f|0;b[2]=b[2]+m|0;b[3]=b[3]+h|0;b[4]=b[4]+p|0;b[5]=b[5]+j|0;b[6]=b[6]+k|0;b[7]=b[7]+l|0},_doFinalize:function(){var a=this._data,d=a.words,b=8*this._nDataBytes,e=8*a.sigBytes;
d[e>>>5]|=128<<24-e%32;d[(e+64>>>9<<4)+14]=h.floor(b/4294967296);d[(e+64>>>9<<4)+15]=b;a.sigBytes=4*d.length;this._process();return this._hash},clone:function(){var a=g.clone.call(this);a._hash=this._hash.clone();return a}});s.SHA256=g._createHelper(f);s.HmacSHA256=g._createHmacHelper(f)})(Math);
</script>

<!-- src="CryptoJS v3.1.2/rollups/sha512.js" -->
<script type="text/javascript"">
/* CryptoJS v3.1.2 code.google.com/p/crypto-js (c) 2009-2013 by Jeff Mott. All rights reserved. code.google.com/p/crypto-js/wiki/License */
var CryptoJS=CryptoJS||function(a,m){var r={},f=r.lib={},g=function(){},l=f.Base={extend:function(a){g.prototype=this;var b=new g;a&&b.mixIn(a);b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)});b.init.prototype=b;b.$super=this;return b},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
p=f.WordArray=l.extend({init:function(a,b){a=this.words=a||[];this.sigBytes=b!=m?b:4*a.length},toString:function(a){return(a||q).stringify(this)},concat:function(a){var b=this.words,d=a.words,c=this.sigBytes;a=a.sigBytes;this.clamp();if(c%4)for(var j=0;j<a;j++)b[c+j>>>2]|=(d[j>>>2]>>>24-8*(j%4)&255)<<24-8*((c+j)%4);else if(65535<d.length)for(j=0;j<a;j+=4)b[c+j>>>2]=d[j>>>2];else b.push.apply(b,d);this.sigBytes+=a;return this},clamp:function(){var n=this.words,b=this.sigBytes;n[b>>>2]&=4294967295<<
32-8*(b%4);n.length=a.ceil(b/4)},clone:function(){var a=l.clone.call(this);a.words=this.words.slice(0);return a},random:function(n){for(var b=[],d=0;d<n;d+=4)b.push(4294967296*a.random()|0);return new p.init(b,n)}}),y=r.enc={},q=y.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var d=[],c=0;c<a;c++){var j=b[c>>>2]>>>24-8*(c%4)&255;d.push((j>>>4).toString(16));d.push((j&15).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,d=[],c=0;c<b;c+=2)d[c>>>3]|=parseInt(a.substr(c,
2),16)<<24-4*(c%8);return new p.init(d,b/2)}},G=y.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var d=[],c=0;c<a;c++)d.push(String.fromCharCode(b[c>>>2]>>>24-8*(c%4)&255));return d.join("")},parse:function(a){for(var b=a.length,d=[],c=0;c<b;c++)d[c>>>2]|=(a.charCodeAt(c)&255)<<24-8*(c%4);return new p.init(d,b)}},fa=y.Utf8={stringify:function(a){try{return decodeURIComponent(escape(G.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data");}},parse:function(a){return G.parse(unescape(encodeURIComponent(a)))}},
h=f.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new p.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=fa.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(n){var b=this._data,d=b.words,c=b.sigBytes,j=this.blockSize,l=c/(4*j),l=n?a.ceil(l):a.max((l|0)-this._minBufferSize,0);n=l*j;c=a.min(4*n,c);if(n){for(var h=0;h<n;h+=j)this._doProcessBlock(d,h);h=d.splice(0,n);b.sigBytes-=c}return new p.init(h,c)},clone:function(){var a=l.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});f.Hasher=h.extend({cfg:l.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){h.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,d){return(new a.init(d)).finalize(b)}},_createHmacHelper:function(a){return function(b,d){return(new ga.HMAC.init(a,
d)).finalize(b)}}});var ga=r.algo={};return r}(Math);
(function(a){var m=CryptoJS,r=m.lib,f=r.Base,g=r.WordArray,m=m.x64={};m.Word=f.extend({init:function(a,p){this.high=a;this.low=p}});m.WordArray=f.extend({init:function(l,p){l=this.words=l||[];this.sigBytes=p!=a?p:8*l.length},toX32:function(){for(var a=this.words,p=a.length,f=[],q=0;q<p;q++){var G=a[q];f.push(G.high);f.push(G.low)}return g.create(f,this.sigBytes)},clone:function(){for(var a=f.clone.call(this),p=a.words=this.words.slice(0),g=p.length,q=0;q<g;q++)p[q]=p[q].clone();return a}})})();
(function(){function a(){return g.create.apply(g,arguments)}for(var m=CryptoJS,r=m.lib.Hasher,f=m.x64,g=f.Word,l=f.WordArray,f=m.algo,p=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),
a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,
2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),
a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,
3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],y=[],q=0;80>q;q++)y[q]=a();f=f.SHA512=r.extend({_doReset:function(){this._hash=new l.init([new g.init(1779033703,4089235720),new g.init(3144134277,2227873595),new g.init(1013904242,4271175723),new g.init(2773480762,1595750129),new g.init(1359893119,2917565137),new g.init(2600822924,725511199),new g.init(528734635,4215389547),new g.init(1541459225,327033209)])},_doProcessBlock:function(a,f){for(var h=this._hash.words,
g=h[0],n=h[1],b=h[2],d=h[3],c=h[4],j=h[5],l=h[6],h=h[7],q=g.high,m=g.low,r=n.high,N=n.low,Z=b.high,O=b.low,$=d.high,P=d.low,aa=c.high,Q=c.low,ba=j.high,R=j.low,ca=l.high,S=l.low,da=h.high,T=h.low,v=q,s=m,H=r,E=N,I=Z,F=O,W=$,J=P,w=aa,t=Q,U=ba,K=R,V=ca,L=S,X=da,M=T,x=0;80>x;x++){var B=y[x];if(16>x)var u=B.high=a[f+2*x]|0,e=B.low=a[f+2*x+1]|0;else{var u=y[x-15],e=u.high,z=u.low,u=(e>>>1|z<<31)^(e>>>8|z<<24)^e>>>7,z=(z>>>1|e<<31)^(z>>>8|e<<24)^(z>>>7|e<<25),D=y[x-2],e=D.high,k=D.low,D=(e>>>19|k<<13)^
(e<<3|k>>>29)^e>>>6,k=(k>>>19|e<<13)^(k<<3|e>>>29)^(k>>>6|e<<26),e=y[x-7],Y=e.high,C=y[x-16],A=C.high,C=C.low,e=z+e.low,u=u+Y+(e>>>0<z>>>0?1:0),e=e+k,u=u+D+(e>>>0<k>>>0?1:0),e=e+C,u=u+A+(e>>>0<C>>>0?1:0);B.high=u;B.low=e}var Y=w&U^~w&V,C=t&K^~t&L,B=v&H^v&I^H&I,ha=s&E^s&F^E&F,z=(v>>>28|s<<4)^(v<<30|s>>>2)^(v<<25|s>>>7),D=(s>>>28|v<<4)^(s<<30|v>>>2)^(s<<25|v>>>7),k=p[x],ia=k.high,ea=k.low,k=M+((t>>>14|w<<18)^(t>>>18|w<<14)^(t<<23|w>>>9)),A=X+((w>>>14|t<<18)^(w>>>18|t<<14)^(w<<23|t>>>9))+(k>>>0<M>>>
0?1:0),k=k+C,A=A+Y+(k>>>0<C>>>0?1:0),k=k+ea,A=A+ia+(k>>>0<ea>>>0?1:0),k=k+e,A=A+u+(k>>>0<e>>>0?1:0),e=D+ha,B=z+B+(e>>>0<D>>>0?1:0),X=V,M=L,V=U,L=K,U=w,K=t,t=J+k|0,w=W+A+(t>>>0<J>>>0?1:0)|0,W=I,J=F,I=H,F=E,H=v,E=s,s=k+e|0,v=A+B+(s>>>0<k>>>0?1:0)|0}m=g.low=m+s;g.high=q+v+(m>>>0<s>>>0?1:0);N=n.low=N+E;n.high=r+H+(N>>>0<E>>>0?1:0);O=b.low=O+F;b.high=Z+I+(O>>>0<F>>>0?1:0);P=d.low=P+J;d.high=$+W+(P>>>0<J>>>0?1:0);Q=c.low=Q+t;c.high=aa+w+(Q>>>0<t>>>0?1:0);R=j.low=R+K;j.high=ba+U+(R>>>0<K>>>0?1:0);S=l.low=
S+L;l.high=ca+V+(S>>>0<L>>>0?1:0);T=h.low=T+M;h.high=da+X+(T>>>0<M>>>0?1:0)},_doFinalize:function(){var a=this._data,f=a.words,h=8*this._nDataBytes,g=8*a.sigBytes;f[g>>>5]|=128<<24-g%32;f[(g+128>>>10<<5)+30]=Math.floor(h/4294967296);f[(g+128>>>10<<5)+31]=h;a.sigBytes=4*f.length;this._process();return this._hash.toX32()},clone:function(){var a=r.clone.call(this);a._hash=this._hash.clone();return a},blockSize:32});m.SHA512=r._createHelper(f);m.HmacSHA512=r._createHmacHelper(f)})();
</script>

<!-- src="CryptoJS v3.1.2/rollups/aes.js" -->
<script type="text/javascript">
/* CryptoJS v3.1.2 code.google.com/p/crypto-js (c) 2009-2013 by Jeff Mott. All rights reserved. code.google.com/p/crypto-js/wiki/License */
var CryptoJS=CryptoJS||function(u,p){var d={},l=d.lib={},s=function(){},t=l.Base={extend:function(a){s.prototype=this;var c=new s;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
r=l.WordArray=t.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=p?c:4*a.length},toString:function(a){return(a||v).stringify(this)},concat:function(a){var c=this.words,e=a.words,j=this.sigBytes;a=a.sigBytes;this.clamp();if(j%4)for(var k=0;k<a;k++)c[j+k>>>2]|=(e[k>>>2]>>>24-8*(k%4)&255)<<24-8*((j+k)%4);else if(65535<e.length)for(k=0;k<a;k+=4)c[j+k>>>2]=e[k>>>2];else c.push.apply(c,e);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
32-8*(c%4);a.length=u.ceil(c/4)},clone:function(){var a=t.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],e=0;e<a;e+=4)c.push(4294967296*u.random()|0);return new r.init(c,a)}}),w=d.enc={},v=w.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var e=[],j=0;j<a;j++){var k=c[j>>>2]>>>24-8*(j%4)&255;e.push((k>>>4).toString(16));e.push((k&15).toString(16))}return e.join("")},parse:function(a){for(var c=a.length,e=[],j=0;j<c;j+=2)e[j>>>3]|=parseInt(a.substr(j,
2),16)<<24-4*(j%8);return new r.init(e,c/2)}},b=w.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var e=[],j=0;j<a;j++)e.push(String.fromCharCode(c[j>>>2]>>>24-8*(j%4)&255));return e.join("")},parse:function(a){for(var c=a.length,e=[],j=0;j<c;j++)e[j>>>2]|=(a.charCodeAt(j)&255)<<24-8*(j%4);return new r.init(e,c)}},x=w.Utf8={stringify:function(a){try{return decodeURIComponent(escape(b.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return b.parse(unescape(encodeURIComponent(a)))}},
q=l.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new r.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=x.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,e=c.words,j=c.sigBytes,k=this.blockSize,b=j/(4*k),b=a?u.ceil(b):u.max((b|0)-this._minBufferSize,0);a=b*k;j=u.min(4*a,j);if(a){for(var q=0;q<a;q+=k)this._doProcessBlock(e,q);q=e.splice(0,a);c.sigBytes-=j}return new r.init(q,j)},clone:function(){var a=t.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});l.Hasher=q.extend({cfg:t.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){q.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,e){return(new a.init(e)).finalize(b)}},_createHmacHelper:function(a){return function(b,e){return(new n.HMAC.init(a,
e)).finalize(b)}}});var n=d.algo={};return d}(Math);
(function(){var u=CryptoJS,p=u.lib.WordArray;u.enc.Base64={stringify:function(d){var l=d.words,p=d.sigBytes,t=this._map;d.clamp();d=[];for(var r=0;r<p;r+=3)for(var w=(l[r>>>2]>>>24-8*(r%4)&255)<<16|(l[r+1>>>2]>>>24-8*((r+1)%4)&255)<<8|l[r+2>>>2]>>>24-8*((r+2)%4)&255,v=0;4>v&&r+0.75*v<p;v++)d.push(t.charAt(w>>>6*(3-v)&63));if(l=t.charAt(64))for(;d.length%4;)d.push(l);return d.join("")},parse:function(d){var l=d.length,s=this._map,t=s.charAt(64);t&&(t=d.indexOf(t),-1!=t&&(l=t));for(var t=[],r=0,w=0;w<
l;w++)if(w%4){var v=s.indexOf(d.charAt(w-1))<<2*(w%4),b=s.indexOf(d.charAt(w))>>>6-2*(w%4);t[r>>>2]|=(v|b)<<24-8*(r%4);r++}return p.create(t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();
(function(u){function p(b,n,a,c,e,j,k){b=b+(n&a|~n&c)+e+k;return(b<<j|b>>>32-j)+n}function d(b,n,a,c,e,j,k){b=b+(n&c|a&~c)+e+k;return(b<<j|b>>>32-j)+n}function l(b,n,a,c,e,j,k){b=b+(n^a^c)+e+k;return(b<<j|b>>>32-j)+n}function s(b,n,a,c,e,j,k){b=b+(a^(n|~c))+e+k;return(b<<j|b>>>32-j)+n}for(var t=CryptoJS,r=t.lib,w=r.WordArray,v=r.Hasher,r=t.algo,b=[],x=0;64>x;x++)b[x]=4294967296*u.abs(u.sin(x+1))|0;r=r.MD5=v.extend({_doReset:function(){this._hash=new w.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(q,n){for(var a=0;16>a;a++){var c=n+a,e=q[c];q[c]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360}var a=this._hash.words,c=q[n+0],e=q[n+1],j=q[n+2],k=q[n+3],z=q[n+4],r=q[n+5],t=q[n+6],w=q[n+7],v=q[n+8],A=q[n+9],B=q[n+10],C=q[n+11],u=q[n+12],D=q[n+13],E=q[n+14],x=q[n+15],f=a[0],m=a[1],g=a[2],h=a[3],f=p(f,m,g,h,c,7,b[0]),h=p(h,f,m,g,e,12,b[1]),g=p(g,h,f,m,j,17,b[2]),m=p(m,g,h,f,k,22,b[3]),f=p(f,m,g,h,z,7,b[4]),h=p(h,f,m,g,r,12,b[5]),g=p(g,h,f,m,t,17,b[6]),m=p(m,g,h,f,w,22,b[7]),
f=p(f,m,g,h,v,7,b[8]),h=p(h,f,m,g,A,12,b[9]),g=p(g,h,f,m,B,17,b[10]),m=p(m,g,h,f,C,22,b[11]),f=p(f,m,g,h,u,7,b[12]),h=p(h,f,m,g,D,12,b[13]),g=p(g,h,f,m,E,17,b[14]),m=p(m,g,h,f,x,22,b[15]),f=d(f,m,g,h,e,5,b[16]),h=d(h,f,m,g,t,9,b[17]),g=d(g,h,f,m,C,14,b[18]),m=d(m,g,h,f,c,20,b[19]),f=d(f,m,g,h,r,5,b[20]),h=d(h,f,m,g,B,9,b[21]),g=d(g,h,f,m,x,14,b[22]),m=d(m,g,h,f,z,20,b[23]),f=d(f,m,g,h,A,5,b[24]),h=d(h,f,m,g,E,9,b[25]),g=d(g,h,f,m,k,14,b[26]),m=d(m,g,h,f,v,20,b[27]),f=d(f,m,g,h,D,5,b[28]),h=d(h,f,
m,g,j,9,b[29]),g=d(g,h,f,m,w,14,b[30]),m=d(m,g,h,f,u,20,b[31]),f=l(f,m,g,h,r,4,b[32]),h=l(h,f,m,g,v,11,b[33]),g=l(g,h,f,m,C,16,b[34]),m=l(m,g,h,f,E,23,b[35]),f=l(f,m,g,h,e,4,b[36]),h=l(h,f,m,g,z,11,b[37]),g=l(g,h,f,m,w,16,b[38]),m=l(m,g,h,f,B,23,b[39]),f=l(f,m,g,h,D,4,b[40]),h=l(h,f,m,g,c,11,b[41]),g=l(g,h,f,m,k,16,b[42]),m=l(m,g,h,f,t,23,b[43]),f=l(f,m,g,h,A,4,b[44]),h=l(h,f,m,g,u,11,b[45]),g=l(g,h,f,m,x,16,b[46]),m=l(m,g,h,f,j,23,b[47]),f=s(f,m,g,h,c,6,b[48]),h=s(h,f,m,g,w,10,b[49]),g=s(g,h,f,m,
E,15,b[50]),m=s(m,g,h,f,r,21,b[51]),f=s(f,m,g,h,u,6,b[52]),h=s(h,f,m,g,k,10,b[53]),g=s(g,h,f,m,B,15,b[54]),m=s(m,g,h,f,e,21,b[55]),f=s(f,m,g,h,v,6,b[56]),h=s(h,f,m,g,x,10,b[57]),g=s(g,h,f,m,t,15,b[58]),m=s(m,g,h,f,D,21,b[59]),f=s(f,m,g,h,z,6,b[60]),h=s(h,f,m,g,C,10,b[61]),g=s(g,h,f,m,j,15,b[62]),m=s(m,g,h,f,A,21,b[63]);a[0]=a[0]+f|0;a[1]=a[1]+m|0;a[2]=a[2]+g|0;a[3]=a[3]+h|0},_doFinalize:function(){var b=this._data,n=b.words,a=8*this._nDataBytes,c=8*b.sigBytes;n[c>>>5]|=128<<24-c%32;var e=u.floor(a/
4294967296);n[(c+64>>>9<<4)+15]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;n[(c+64>>>9<<4)+14]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360;b.sigBytes=4*(n.length+1);this._process();b=this._hash;n=b.words;for(a=0;4>a;a++)c=n[a],n[a]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360;return b},clone:function(){var b=v.clone.call(this);b._hash=this._hash.clone();return b}});t.MD5=v._createHelper(r);t.HmacMD5=v._createHmacHelper(r)})(Math);
(function(){var u=CryptoJS,p=u.lib,d=p.Base,l=p.WordArray,p=u.algo,s=p.EvpKDF=d.extend({cfg:d.extend({keySize:4,hasher:p.MD5,iterations:1}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,r){for(var p=this.cfg,s=p.hasher.create(),b=l.create(),u=b.words,q=p.keySize,p=p.iterations;u.length<q;){n&&s.update(n);var n=s.update(d).finalize(r);s.reset();for(var a=1;a<p;a++)n=s.finalize(n),s.reset();b.concat(n)}b.sigBytes=4*q;return b}});u.EvpKDF=function(d,l,p){return s.create(p).compute(d,
l)}})();
CryptoJS.lib.Cipher||function(u){var p=CryptoJS,d=p.lib,l=d.Base,s=d.WordArray,t=d.BufferedBlockAlgorithm,r=p.enc.Base64,w=p.algo.EvpKDF,v=d.Cipher=t.extend({cfg:l.extend(),createEncryptor:function(e,a){return this.create(this._ENC_XFORM_MODE,e,a)},createDecryptor:function(e,a){return this.create(this._DEC_XFORM_MODE,e,a)},init:function(e,a,b){this.cfg=this.cfg.extend(b);this._xformMode=e;this._key=a;this.reset()},reset:function(){t.reset.call(this);this._doReset()},process:function(e){this._append(e);return this._process()},
finalize:function(e){e&&this._append(e);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(b,k,d){return("string"==typeof k?c:a).encrypt(e,b,k,d)},decrypt:function(b,k,d){return("string"==typeof k?c:a).decrypt(e,b,k,d)}}}});d.StreamCipher=v.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var b=p.mode={},x=function(e,a,b){var c=this._iv;c?this._iv=u:c=this._prevBlock;for(var d=0;d<b;d++)e[a+d]^=
c[d]},q=(d.BlockCipherMode=l.extend({createEncryptor:function(e,a){return this.Encryptor.create(e,a)},createDecryptor:function(e,a){return this.Decryptor.create(e,a)},init:function(e,a){this._cipher=e;this._iv=a}})).extend();q.Encryptor=q.extend({processBlock:function(e,a){var b=this._cipher,c=b.blockSize;x.call(this,e,a,c);b.encryptBlock(e,a);this._prevBlock=e.slice(a,a+c)}});q.Decryptor=q.extend({processBlock:function(e,a){var b=this._cipher,c=b.blockSize,d=e.slice(a,a+c);b.decryptBlock(e,a);x.call(this,
e,a,c);this._prevBlock=d}});b=b.CBC=q;q=(p.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,l=[],n=0;n<c;n+=4)l.push(d);c=s.create(l,c);a.concat(c)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};d.BlockCipher=v.extend({cfg:v.cfg.extend({mode:b,padding:q}),reset:function(){v.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,
this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var n=d.CipherParams=l.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),b=(p.format={}).OpenSSL={stringify:function(a){var b=a.ciphertext;a=a.salt;return(a?s.create([1398893684,
1701076831]).concat(a).concat(b):b).toString(r)},parse:function(a){a=r.parse(a);var b=a.words;if(1398893684==b[0]&&1701076831==b[1]){var c=s.create(b.slice(2,4));b.splice(0,4);a.sigBytes-=16}return n.create({ciphertext:a,salt:c})}},a=d.SerializableCipher=l.extend({cfg:l.extend({format:b}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var l=a.createEncryptor(c,d);b=l.finalize(b);l=l.cfg;return n.create({ciphertext:b,key:c,iv:l.iv,algorithm:a,mode:l.mode,padding:l.padding,blockSize:a.blockSize,formatter:d.format})},
decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);return a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),p=(p.kdf={}).OpenSSL={execute:function(a,b,c,d){d||(d=s.random(8));a=w.create({keySize:b+c}).compute(a,d);c=s.create(a.words.slice(b),4*c);a.sigBytes=4*b;return n.create({key:a,iv:c,salt:d})}},c=d.PasswordBasedCipher=a.extend({cfg:a.cfg.extend({kdf:p}),encrypt:function(b,c,d,l){l=this.cfg.extend(l);d=l.kdf.execute(d,
b.keySize,b.ivSize);l.iv=d.iv;b=a.encrypt.call(this,b,c,d.key,l);b.mixIn(d);return b},decrypt:function(b,c,d,l){l=this.cfg.extend(l);c=this._parse(c,l.format);d=l.kdf.execute(d,b.keySize,b.ivSize,c.salt);l.iv=d.iv;return a.decrypt.call(this,b,c,d.key,l)}})}();
(function(){for(var u=CryptoJS,p=u.lib.BlockCipher,d=u.algo,l=[],s=[],t=[],r=[],w=[],v=[],b=[],x=[],q=[],n=[],a=[],c=0;256>c;c++)a[c]=128>c?c<<1:c<<1^283;for(var e=0,j=0,c=0;256>c;c++){var k=j^j<<1^j<<2^j<<3^j<<4,k=k>>>8^k&255^99;l[e]=k;s[k]=e;var z=a[e],F=a[z],G=a[F],y=257*a[k]^16843008*k;t[e]=y<<24|y>>>8;r[e]=y<<16|y>>>16;w[e]=y<<8|y>>>24;v[e]=y;y=16843009*G^65537*F^257*z^16843008*e;b[k]=y<<24|y>>>8;x[k]=y<<16|y>>>16;q[k]=y<<8|y>>>24;n[k]=y;e?(e=z^a[a[a[G^z]]],j^=a[a[j]]):e=j=1}var H=[0,1,2,4,8,
16,32,64,128,27,54],d=d.AES=p.extend({_doReset:function(){for(var a=this._key,c=a.words,d=a.sigBytes/4,a=4*((this._nRounds=d+6)+1),e=this._keySchedule=[],j=0;j<a;j++)if(j<d)e[j]=c[j];else{var k=e[j-1];j%d?6<d&&4==j%d&&(k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[k&255]):(k=k<<8|k>>>24,k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[k&255],k^=H[j/d|0]<<24);e[j]=e[j-d]^k}c=this._invKeySchedule=[];for(d=0;d<a;d++)j=a-d,k=d%4?e[j]:e[j-4],c[d]=4>d||4>=j?k:b[l[k>>>24]]^x[l[k>>>16&255]]^q[l[k>>>
8&255]]^n[l[k&255]]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,t,r,w,v,l)},decryptBlock:function(a,c){var d=a[c+1];a[c+1]=a[c+3];a[c+3]=d;this._doCryptBlock(a,c,this._invKeySchedule,b,x,q,n,s);d=a[c+1];a[c+1]=a[c+3];a[c+3]=d},_doCryptBlock:function(a,b,c,d,e,j,l,f){for(var m=this._nRounds,g=a[b]^c[0],h=a[b+1]^c[1],k=a[b+2]^c[2],n=a[b+3]^c[3],p=4,r=1;r<m;r++)var q=d[g>>>24]^e[h>>>16&255]^j[k>>>8&255]^l[n&255]^c[p++],s=d[h>>>24]^e[k>>>16&255]^j[n>>>8&255]^l[g&255]^c[p++],t=
d[k>>>24]^e[n>>>16&255]^j[g>>>8&255]^l[h&255]^c[p++],n=d[n>>>24]^e[g>>>16&255]^j[h>>>8&255]^l[k&255]^c[p++],g=q,h=s,k=t;q=(f[g>>>24]<<24|f[h>>>16&255]<<16|f[k>>>8&255]<<8|f[n&255])^c[p++];s=(f[h>>>24]<<24|f[k>>>16&255]<<16|f[n>>>8&255]<<8|f[g&255])^c[p++];t=(f[k>>>24]<<24|f[n>>>16&255]<<16|f[g>>>8&255]<<8|f[h&255])^c[p++];n=(f[n>>>24]<<24|f[g>>>16&255]<<16|f[h>>>8&255]<<8|f[k&255])^c[p++];a[b]=q;a[b+1]=s;a[b+2]=t;a[b+3]=n},keySize:8});u.AES=p._createHelper(d)})();
</script>

<!-- src="CryptoJS v3.1.2/rollups/pbkdf2.js" -->
<script type="text/javascript" >
/* CryptoJS v3.1.2 code.google.com/p/crypto-js (c) 2009-2013 by Jeff Mott. All rights reserved. code.google.com/p/crypto-js/wiki/License */
var CryptoJS=CryptoJS||function(g,j){var e={},d=e.lib={},m=function(){},n=d.Base={extend:function(a){m.prototype=this;var c=new m;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
q=d.WordArray=n.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=j?c:4*a.length},toString:function(a){return(a||l).stringify(this)},concat:function(a){var c=this.words,p=a.words,f=this.sigBytes;a=a.sigBytes;this.clamp();if(f%4)for(var b=0;b<a;b++)c[f+b>>>2]|=(p[b>>>2]>>>24-8*(b%4)&255)<<24-8*((f+b)%4);else if(65535<p.length)for(b=0;b<a;b+=4)c[f+b>>>2]=p[b>>>2];else c.push.apply(c,p);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
32-8*(c%4);a.length=g.ceil(c/4)},clone:function(){var a=n.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*g.random()|0);return new q.init(c,a)}}),b=e.enc={},l=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],f=0;f<a;f++){var d=c[f>>>2]>>>24-8*(f%4)&255;b.push((d>>>4).toString(16));b.push((d&15).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],f=0;f<c;f+=2)b[f>>>3]|=parseInt(a.substr(f,
2),16)<<24-4*(f%8);return new q.init(b,c/2)}},k=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],f=0;f<a;f++)b.push(String.fromCharCode(c[f>>>2]>>>24-8*(f%4)&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],f=0;f<c;f++)b[f>>>2]|=(a.charCodeAt(f)&255)<<24-8*(f%4);return new q.init(b,c)}},h=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(k.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data");}},parse:function(a){return k.parse(unescape(encodeURIComponent(a)))}},
u=d.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=h.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var b=this._data,d=b.words,f=b.sigBytes,l=this.blockSize,e=f/(4*l),e=a?g.ceil(e):g.max((e|0)-this._minBufferSize,0);a=e*l;f=g.min(4*a,f);if(a){for(var h=0;h<a;h+=l)this._doProcessBlock(d,h);h=d.splice(0,a);b.sigBytes-=f}return new q.init(h,f)},clone:function(){var a=n.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});d.Hasher=u.extend({cfg:n.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){u.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,d){return(new a.init(d)).finalize(b)}},_createHmacHelper:function(a){return function(b,d){return(new w.HMAC.init(a,
d)).finalize(b)}}});var w=e.algo={};return e}(Math);
(function(){var g=CryptoJS,j=g.lib,e=j.WordArray,d=j.Hasher,m=[],j=g.algo.SHA1=d.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(d,e){for(var b=this._hash.words,l=b[0],k=b[1],h=b[2],g=b[3],j=b[4],a=0;80>a;a++){if(16>a)m[a]=d[e+a]|0;else{var c=m[a-3]^m[a-8]^m[a-14]^m[a-16];m[a]=c<<1|c>>>31}c=(l<<5|l>>>27)+j+m[a];c=20>a?c+((k&h|~k&g)+1518500249):40>a?c+((k^h^g)+1859775393):60>a?c+((k&h|k&g|h&g)-1894007588):c+((k^h^
g)-899497514);j=g;g=h;h=k<<30|k>>>2;k=l;l=c}b[0]=b[0]+l|0;b[1]=b[1]+k|0;b[2]=b[2]+h|0;b[3]=b[3]+g|0;b[4]=b[4]+j|0},_doFinalize:function(){var d=this._data,e=d.words,b=8*this._nDataBytes,l=8*d.sigBytes;e[l>>>5]|=128<<24-l%32;e[(l+64>>>9<<4)+14]=Math.floor(b/4294967296);e[(l+64>>>9<<4)+15]=b;d.sigBytes=4*e.length;this._process();return this._hash},clone:function(){var e=d.clone.call(this);e._hash=this._hash.clone();return e}});g.SHA1=d._createHelper(j);g.HmacSHA1=d._createHmacHelper(j)})();
(function(){var g=CryptoJS,j=g.enc.Utf8;g.algo.HMAC=g.lib.Base.extend({init:function(e,d){e=this._hasher=new e.init;"string"==typeof d&&(d=j.parse(d));var g=e.blockSize,n=4*g;d.sigBytes>n&&(d=e.finalize(d));d.clamp();for(var q=this._oKey=d.clone(),b=this._iKey=d.clone(),l=q.words,k=b.words,h=0;h<g;h++)l[h]^=1549556828,k[h]^=909522486;q.sigBytes=b.sigBytes=n;this.reset()},reset:function(){var e=this._hasher;e.reset();e.update(this._iKey)},update:function(e){this._hasher.update(e);return this},finalize:function(e){var d=
this._hasher;e=d.finalize(e);d.reset();return d.finalize(this._oKey.clone().concat(e))}})})();
(function(){var g=CryptoJS,j=g.lib,e=j.Base,d=j.WordArray,j=g.algo,m=j.HMAC,n=j.PBKDF2=e.extend({cfg:e.extend({keySize:4,hasher:j.SHA1,iterations:1}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(e,b){for(var g=this.cfg,k=m.create(g.hasher,e),h=d.create(),j=d.create([1]),n=h.words,a=j.words,c=g.keySize,g=g.iterations;n.length<c;){var p=k.update(b).finalize(j);k.reset();for(var f=p.words,v=f.length,s=p,t=1;t<g;t++){s=k.finalize(s);k.reset();for(var x=s.words,r=0;r<v;r++)f[r]^=x[r]}h.concat(p);
a[0]++}h.sigBytes=4*c;return h}});g.PBKDF2=function(d,b,e){return n.create(e).compute(d,b)}})();
</script>


<!-- MAIN SCRIPT -->
<script type="text/javascript">
"use strict";

// BEGIN INITIALIZE
const keySize = 256; //bits
const ivSize = 128;  //bits
var   pbkdf2_iterations_string_global;
const pbkdf2_iterations_stringsize_global = 8; // fixed number of characters to pass on the number (which will be in base10 and crammed to the right)
var   pbkdf2_iterations_global = Math.pow(2,10); reset_output();   //reset_pbkdf2_iterations();
// 2^10 = 1024 iterations which makes it so you can subtract a few bits from the ideal minimum of 128, but not many.
// The main benefit rather of pbkdf2 iterations seems to be in a signon system where same-paswords will have that-much-different stored "keys" if there's dubiousness in the random number generation somehow -- I think!
var message = "There was a demon that lived in the air." + String.fromCharCode(10) + "They said whoever challenged him would die." + String.fromCharCode(10) + "Their controls would freeze up," + String.fromCharCode(10) + "        their planes would buffet wildly," + String.fromCharCode(10) + "                and they would disintegrate.";
var password = "change_this_crappy_password";
var salt_global;
var iv_global;
var key_global;
const slash_global   = "/"; // the slash character
const subchar_global = "~"; // substitute character for the slash;
//const nullstring_global = "";

document.getElementById("plaintext_box").value = message;
document.getElementById("pw_box").value = password;

var constants_string_global; reset_output();

// END INITIALIZE

function encrypt (plaintext, passwd) {
  var salt = CryptoJS.lib.WordArray.random(128/8);
  salt_global = salt;  // added in to be able to pass the parameter to the display 
  var key = CryptoJS.PBKDF2( passwd, salt, {  keySize: keySize/32,  iterations: pbkdf2_iterations_global  });
  key_global = key;  // added in to be able to pass the parameter to the display 
  var iv = CryptoJS.lib.WordArray.random(128/8);
  iv_global = iv;  // added in to be able to pass the parameter to the display 
  var encrypted = CryptoJS.AES.encrypt(plaintext, key, { iv: iv,  padding: CryptoJS.pad.Pkcs7,  mode: CryptoJS.mode.CBC  });
  // salt, iv will be hex 32 in length
  // append them to the ciphertext for use  in decryption
  var encryptedmessage = salt.toString()+ iv.toString() + pbkdf2_iterations_string_global + encrypted.toString();
  return encryptedmessage;
}

function decrypt (encryptedmessage, passwd) {
  var salt = CryptoJS.enc.Hex.parse(encryptedmessage.substr(0, 32));
  var iv = CryptoJS.enc.Hex.parse(encryptedmessage.substr(32, 32));
  var pbkdf2_iterations_decrypt_string = encryptedmessage.substr(64, pbkdf2_iterations_stringsize_global);
  var pbkdf2_iterations_decrypt = parseInt(pbkdf2_iterations_decrypt_string,10);
  //console.log(pbkdf2_iterations_decrypt_string + "    ", pbkdf2_iterations_decrypt);

  var encrypted = encryptedmessage.substring(64 + pbkdf2_iterations_stringsize_global);
  var key = CryptoJS.PBKDF2( passwd, salt, { keySize: keySize/32, iterations: pbkdf2_iterations_decrypt  });
  var decrypted = CryptoJS.AES.decrypt(encrypted, key, { iv: iv, padding: CryptoJS.pad.Pkcs7,  mode: CryptoJS.mode.CBC  })
  return decrypted;
}

function d_encrypt(box_id){
    var plaintext_box_from_form =  document.getElementById(box_id).value;
    var pw_from_form =  document.getElementById("pw_box").value;
    reset_output();
    if (pw_from_form == "") {alert("Password is empty, try again."); return;} // don't accept a null pw
    var encrypted_base64 = encrypt(plaintext_box_from_form, pw_from_form);
    var incidentals_string = constants_string_global + "\n"
                           + "PW length (number of characters): " + pw_from_form.length + "\n" 
                           + "Salt: " + salt_global.toString() + "\n" 
                           + "Key:  " + key_global.toString() + "\n" 
                           + "IV:   " + iv_global.toString();
                           //+ "pw_box maxlength    " + document.getElementById("pw_box").maxLength + "\n" 
                           //+ "incidentals_box maxlength    " + document.getElementById("incidentals_box").maxLength + "\n" 
                           //+ "encrypted_base64_box maxlength    " + document.getElementById("encrypted_base64_box").maxLength; 
    document.getElementById("incidentals_box").value = incidentals_string;


    document.getElementById("encrypted_base64_box").value = d_format(d_toSubchar(encrypted_base64),64); // convert slashes to the substitute character, then format to 64 cpl as default

    return;
    }

function d_decrypt(){
    var in_data_from_form =  document.getElementById("encrypted_input_box").value;
    in_data_from_form = d_toSlash(in_data_from_form); // convert substitute characters to slash
    in_data_from_form = d_strip_non_base64(in_data_from_form); // strip all non-base64 characters such as carriage returns, etc. used for tidying up what is otherwise just a single line of printable characters.
    var pw_from_form =  document.getElementById("pw_box").value;
    
    document.getElementById("decrypted_text_box").value = "";
    var d_decrypted_from_base64 = decrypt(in_data_from_form, pw_from_form).toString(CryptoJS.enc.Utf8)
    document.getElementById("decrypted_text_box").value = d_decrypted_from_base64;
    return;
    }

function d_sha256(box_id) {
    var str = document.getElementById(box_id).value;
    document.getElementById("encrypted_base64_box").value = CryptoJS.SHA256(str).toString(CryptoJS.enc.Hex);
    }

function d_sha512(box_id) {
    var str = document.getElementById(box_id).value;
    document.getElementById("encrypted_base64_box").value = CryptoJS.SHA512(str).toString(CryptoJS.enc.Hex);
    }

function d_clear_register(box_id){
    document.getElementById(box_id).value = "";
    // Also clear incidentals:
    if (box_id == "pw_box" || box_id == "plaintext_box" ) { document.getElementById("incidentals_box").value = constants_string_global; }
    }

function d_copy_encrypt_result_to_encrypt_input(){
    document.getElementById("encrypted_input_box").value = document.getElementById("encrypted_base64_box").value;
    }

function d_copy_to_clipboard(box_id){
    document.getElementById(box_id).select();
    document.execCommand("copy");
    }

function d_delete_selected_text(box_id){
    var box = document.getElementById(box_id);
    var start = box.selectionStart; var end = box.selectionEnd; var len = box.value.length;
    box.value = box.value.substring(0 ,start)  + box.value.substring(end, len);
    return;
    }

function d_delete_unselected_text(box_id){
    var box = document.getElementById(box_id);
    var start = box.selectionStart; var end = box.selectionEnd;
    box.value = box.value.substring(start, end);
    return;
    }

function d_shuffle(){
    var pw_from_form =  document.getElementById("pw_box").value;
    var pw_shuffled = "";
    var len = pw_from_form.length;
    var i = 0;
    // Surely there must be a more efficient algorithm than this, but it should work
    var rand_index = new Array();
    var index_taken = new Array();
    for ( i = 0; i < len; i++) index_taken[i] = false; // initialize
    for ( i = 0; i < len; i++) {
        var rand = Math.floor(Math.random() * len );  // make one try at finding a pigeon hole
            while (index_taken[rand]) rand = Math.floor(Math.random() * len );  // if no hole there, keep trying
        if ( rand>=len || rand<0 ) {alert("Shuffle index out of range.  Try again.\nIt's a logical error in the code, not your fault.  It needs to be fixed! :-)"); return; }

        index_taken[rand] = true;
        rand_index[i] = rand;
        pw_shuffled = pw_shuffled + pw_from_form[rand];
        //document.getElementById("encrypted_input_box").value = document.getElementById("encrypted_input_box").value + index_taken[i] + " " + rand_index[i]  + " " + pw_shuffled[i]  + "\n";
        }//endfor
      document.getElementById("pw_box").value = pw_shuffled;
    }//endfunction

function get_base64_characters(number_of_characters) {
    var buffer = 8; // this is used to get more than needed so to be able to trim the less-random characters at the end
    var rand_warray = CryptoJS.lib.WordArray.random(number_of_characters*6/8 + buffer); // make it bigger (with "buffer") to be able to trim the padding and predictable characters off the end of the b64 string
    var b64 = CryptoJS.enc.Base64.stringify(rand_warray);
    b64 = d_toSubchar(b64).substr(0,number_of_characters); // convert slashes to the substitute character and trim off the last 8 or so characters 
    document.getElementById("pw_box").value = document.getElementById("pw_box").value + b64;
    }

function get_hex_characters(number_of_characters) { 
    document.getElementById("pw_box").value = document.getElementById("pw_box").value + CryptoJS.lib.WordArray.random(number_of_characters/2).toString();
    }

var last_box_format_global = 64; // "32" = 32 cpl, "64" = 64 cpl, "0" = infinite cpl and no prefix/suffix (i.e. "unneatened")
function d_box_cycle_format(box_id) { // format specified box
    var next_format;
    if (last_box_format_global == 64) next_format = 32;
    if (last_box_format_global == 32) next_format = 0;
    if (last_box_format_global == 0) next_format = 64;
    var in_string = document.getElementById(box_id).value;
    in_string = d_format(in_string, 0); // gotta start with a single line
    in_string = d_format(in_string, next_format);
    last_box_format_global = next_format;
    document.getElementById(box_id).value = in_string;
    return;
    }

function d_format(in_string, cpl) // cpl = characters_per_line
    {
    if (cpl == 0) return d_strip_non_base64(in_string);

    var len = in_string.length;
    var new_string = ">>>" + String.fromCharCode(10);
    var n_lines = Math.floor(len/cpl);
    if ( ((len/cpl) - Math.floor(len/cpl)) > 0 ) n_lines = n_lines + 1; // allocate for an incomplete line
    for ( var i = 0; i < n_lines; i++) new_string = new_string + in_string.substr(i*cpl,cpl) + String.fromCharCode(10);
    new_string = new_string + "<<<";
    return new_string;
    }


function d_toSlash(in_string) { // return string with the each substitute character (subchar_global) converted back to a slash.
    var len = in_string.length;
    for ( var i = 0; i < len; i++) if (in_string[i] == subchar_global)  in_string = setCharAt(in_string, i, slash_global);
    return in_string;
    }

function d_toSubchar(in_string) {  // return string with each slash converted to the substitute character (subchar_global)
    var len = in_string.length;
    for ( var i = 0; i < len; i++) if (in_string[i] == slash_global)  in_string = setCharAt(in_string, i, subchar_global);
    return in_string;
    }

function setCharAt(in_string, index, chr) { // own function required for this because strings are immutable
    if( (index > in_string.length-1) || index<0) return in_string;  // quiet "index out of range"
    return in_string.substr(0,index) + chr[0] + in_string.substr(index+1);
}

function d_strip_non_base64(in_string) {  // return string with non-base64 characters stripped out ("subchar_global" stays in)
    var len = in_string.length;
    var new_string = "";
    var previous_index = -1;
    for ( var i = 0; i < len; i++)
        if ( !(is_base64_char(in_string[i]))  ) { new_string = new_string + in_string.substring(previous_index+1,i); previous_index = i; }
    new_string = new_string + in_string.substring(previous_index+1,len); // add in the last bit of the in_string
    return new_string;
    }

function is_base64_char(in_char) { // returns true if the character is 0-9, a-z, A-Z, "+", "/", or "=", OR "~"
    var charcode =  in_char.charCodeAt(0);
    //document.getElementById("pw_box").value = document.getElementById("pw_box").value + "\n-------" + in_char[0] + " " + in_char + " " + charcode; // + " " + isbase64;
    if (charcode >= 48 && charcode <= 57) return true; // "0" through "9"
    if (charcode >= 65 && charcode <= 90) return true; // "A" through "Z"
    if (charcode >= 97 && charcode <= 122) return true; // "a" through "z"
    if (charcode == 43 || charcode == 47 || charcode == 61 ) return true; // "+", "/", and "="
    if (in_char[0] == subchar_global) return true; //treat as a base64 character for now
    return false;
    }

//var get_pbkdf2_iterations_input_string_global;
function get_new_pbkdf2_iterations() { 
    var pbkdf2_iterations_new = pbkdf2_iterations_global;
    var pbkdf2_iterations_orig = pbkdf2_iterations_global;
    var in_string = prompt("Enter the new value for the number of pbkdf2 iterations\n(Make it an integer more than zero and less than 8192)", pbkdf2_iterations_global.toString());
    pbkdf2_iterations_new = parseInt(in_string);

    if ((typeof(pbkdf2_iterations_new) != "number") || isNaN(pbkdf2_iterations_new) ) {
        alert("The value given for the number of pbkdf2 iterations could not be processed into a number.\nThe original value was unchanged.");
        return;}
        else {
             pbkdf2_iterations_global = pbkdf2_iterations_new;
             if (pbkdf2_iterations_global > 8192) pbkdf2_iterations_global = 8192;
             if (pbkdf2_iterations_global < 1) pbkdf2_iterations_global = 1;
             if (pbkdf2_iterations_orig != pbkdf2_iterations_global) {
                 reset_output();
                 alert("The number of pbkdf2 iterations has been changed to:" + pbkdf2_iterations_global.toString());
                 }
             if (pbkdf2_iterations_orig == pbkdf2_iterations_global) alert("The number of pbkdf2 iterations has not been changed.\n(The number entered was the same as the original number.)");
             }
    }

function reset_output() { 
    pbkdf2_iterations_string_global = "0000000000000000" + pbkdf2_iterations_global.toString();
    pbkdf2_iterations_string_global = pbkdf2_iterations_string_global.substring(pbkdf2_iterations_string_global.length - pbkdf2_iterations_stringsize_global, pbkdf2_iterations_string_global.length) // trim the left side off to the fixed number of characters
    constants_string_global = "keySize: " + keySize.toString() + "    " 
                            + "ivSize: " + ivSize.toString() + "    "
                            + "pbkdf2_iterations: " + pbkdf2_iterations_global.toString();
    document.getElementById("incidentals_box").value = constants_string_global;
    document.getElementById("encrypted_base64_box").value = "";
    }

</script>

</body>
</html>
